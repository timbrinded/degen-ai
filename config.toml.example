# Hyperliquid Trading Agent Configuration
# Copy this file to config.toml and fill in your actual values

[hyperliquid]
# Your Hyperliquid account address (wallet address)
account_address = "0x0000000000000000000000000000000000000000"

# Your account private key (keep this secure!)
secret_key = "0x0000000000000000000000000000000000000000000000000000000000000000"

# API base URL - use testnet for testing, mainnet for production
# Testnet: https://api.hyperliquid-testnet.xyz
# Mainnet: https://api.hyperliquid.xyz
base_url = "https://api.hyperliquid-testnet.xyz"

[llm]
# LLM provider: "openai" or "anthropic"
provider = "openai"

# Model name (e.g., "gpt-4", "gpt-4-turbo", "claude-3-opus-20240229")
model = "gpt-4"

# API key for your LLM provider
api_key = "sk-..."

# Temperature for LLM responses (0.0-1.0, higher = more creative)
temperature = 0.7

# Maximum tokens in LLM response
max_tokens = 1000

[agent]
# Time to wait between trading loop iterations (in seconds)
tick_interval_seconds = 60

# Maximum number of retries for failed API calls
max_retries = 5

# Base for exponential backoff (wait time = base^attempt)
retry_backoff_base = 2.0

# Logging level: "DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"
log_level = "INFO"

# Path to the prompt template file
prompt_template_path = "prompts/default.txt"

# ============================================================================
# GOVERNANCE SYSTEM CONFIGURATION
# ============================================================================
# The governance system prevents "strategy thrash" by introducing multi-timescale
# decision-making, policy persistence, and change governance. It separates execution
# (fast loop), planning (medium loop), and regime detection (slow loop).

[governance]
# Fast loop: Deterministic execution following the active plan (no LLM queries)
# Recommended: 5-30 seconds for responsive execution
fast_loop_interval_seconds = 10

# Medium loop: Tactical planning and Strategy Plan Card maintenance (LLM queries)
# Recommended: 15-120 minutes for hobby trading, 5-30 minutes for active trading
medium_loop_interval_minutes = 30

# Slow loop: Regime detection and macro-level policy changes
# Recommended: 24 hours for hobby trading, 4-12 hours for active trading
slow_loop_interval_hours = 24

[governance.governor]
# Minimum advantage required over change cost (in basis points)
# This prevents unprofitable strategy switches. The expected advantage from a new
# strategy must exceed the switching cost by at least this amount.
# Recommended: 50-100 bps for conservative, 25-50 bps for aggressive
minimum_advantage_over_cost_bps = 50.0

# Cooldown period after plan changes (in minutes)
# Prevents rapid strategy flip-flopping by enforcing a minimum time between changes.
# Recommended: 60-120 minutes for hobby trading, 30-60 minutes for active trading
cooldown_after_change_minutes = 60

# Percentage of portfolio to rotate per medium loop cycle during rebalancing
# Gradual rebalancing reduces market impact and slippage. Lower values = slower rotation.
# Recommended: 25-50% for hobby trading, 10-25% for active trading
partial_rotation_pct_per_cycle = 25.0

# Path to persist governor state (relative to project root)
# The governor saves active plan, timing state, and rebalance progress to survive restarts.
state_persistence_path = "state/governor.json"

[governance.regime_detector]
# Number of medium loop cycles required to confirm regime change
# Higher values prevent false regime changes from temporary market noise.
# Recommended: 3-5 cycles for hobby trading, 2-3 cycles for active trading
confirmation_cycles_required = 3

# Confidence threshold to enter a new regime (0.0-1.0)
# Higher values require stronger evidence before switching regimes.
# Recommended: 0.6-0.8 for conservative, 0.5-0.6 for aggressive
hysteresis_enter_threshold = 0.7

# Confidence threshold to exit current regime (0.0-1.0)
# Lower than enter threshold creates hysteresis, preventing ping-ponging.
# Recommended: 0.3-0.5 (should be 0.2-0.3 below enter threshold)
hysteresis_exit_threshold = 0.4

# Hours before scheduled macro event to lock plan changes
# Prevents strategy changes immediately before high-impact events (FOMC, CPI, etc.)
# Recommended: 2-4 hours for conservative, 1-2 hours for aggressive
event_lock_window_hours_before = 2

# Hours after scheduled macro event to lock plan changes
# Allows volatility to settle before making strategy decisions.
# Recommended: 1-2 hours for conservative, 0.5-1 hour for aggressive
event_lock_window_hours_after = 1

[governance.tripwire]
# Minimum margin ratio before triggering safety tripwire (0.0-1.0)
# Triggers when account margin falls below this level. Lower = more aggressive.
# Recommended: 0.15-0.25 for hobby trading (exchange minimum is typically 0.03-0.05)
min_margin_ratio = 0.15

# Proximity to liquidation price that triggers warning (0.0-1.0)
# Triggers when position is within this percentage of liquidation price.
# Recommended: 0.20-0.30 for conservative, 0.15-0.20 for aggressive
liquidation_proximity_threshold = 0.25

# Maximum daily loss percentage before cutting positions (0.0-100.0)
# Absolute safety limit - cuts positions when daily loss exceeds this percentage.
# Recommended: 3-5% for hobby trading, 5-10% for active trading
daily_loss_limit_pct = 5.0

# Maximum seconds of data staleness before freezing new risk
# Prevents trading on stale data when API is slow or unresponsive.
# Recommended: 300-600 seconds (5-10 minutes)
max_data_staleness_seconds = 300

# Maximum consecutive API failures before triggering operational tripwire
# Freezes new risk when API becomes unreliable.
# Recommended: 3-5 failures for conservative, 5-10 for aggressive
max_api_failure_count = 3

# Percentage of positions to close when emergency tripwire triggers (0.0-100.0)
# 100.0 = full liquidation, 50.0 = half positions, etc.
# This applies when CUT_SIZE_TO_FLOOR tripwire action is triggered.
# Recommended: 100.0 for maximum safety, 50.0-75.0 for partial reduction
emergency_reduction_pct = 100.0

# ============================================================================
# SIGNAL SYSTEM CONFIGURATION
# ============================================================================
# The signal system collects real-time market data from multiple sources to
# enable accurate regime detection and risk monitoring. It uses async providers,
# caching, and graceful degradation for reliability.

[signals]
# Global timeout for signal collection requests (in seconds)
# If collection takes longer, falls back to cached signals
# Recommended: 30-60 seconds
timeout_seconds = 30.0

# Enable caching for expensive calculations and API calls
# Recommended: true for production, false only for debugging
caching_enabled = true

# Path to SQLite cache database (relative to project root)
db_path = "state/signal_cache.db"

[signals.hyperliquid]
# Maximum retry attempts for Hyperliquid API calls
# Recommended: 3-5 retries
max_retries = 3

# Timeout for individual Hyperliquid API calls (in seconds)
# Recommended: 5-10 seconds
timeout_seconds = 10.0

# Exponential backoff factor for retries
# Wait time = initial_delay * (backoff_factor ^ attempt)
# Recommended: 2.0
backoff_factor = 2.0

# Initial delay before first retry (in seconds)
# Recommended: 1.0
initial_delay_seconds = 1.0

[signals.onchain]
# Enable on-chain data collection (token unlocks, whale flows)
# Recommended: true for production, false if no API key available
enabled = false

# On-chain data provider: "token_unlocks", "nansen", "dune", or leave empty to disable
# - token_unlocks: Token unlock schedule data (REQUIRES API KEY)
# - nansen: On-chain analytics (REQUIRES API KEY)
# - dune: Blockchain query data (REQUIRES API KEY)
# - Empty/None: Disabled (no on-chain data collection)
# Recommended: "token_unlocks" for production when you have an API key
provider = ""

# API key for on-chain data provider (or set ONCHAIN_API_KEY env var)
# REQUIRED when provider is set. Leave empty to use environment variable.
# Get API keys from:
# - token_unlocks: https://token.unlocks.app
# - nansen: https://nansen.ai
# - dune: https://dune.com
api_key = ""

# Cache TTL for on-chain data (in seconds)
# Recommended: 3600 (1 hour)
cache_ttl_seconds = 3600

[signals.external_market]
# Enable external market data (BTC/ETH/SPX prices, correlations)
# Recommended: true for production
enabled = true

# Enable CoinGecko API for crypto price data
# FREE tier available - API key is OPTIONAL (provides higher rate limits)
# Recommended: true
use_coingecko = true

# CoinGecko API key (or set COINGECKO_API_KEY env var)
# OPTIONAL - Leave empty for free tier or to use environment variable
# Free tier: 10-50 calls/minute (sufficient for most use cases)
# Pro tier: Higher limits with API key from https://coingecko.com/api
coingecko_api_key = ""

# Enable yfinance for traditional market data (SPX, etc.)
# FREE - No API key required, uses Yahoo Finance
# Recommended: true
use_yfinance = true

# JBlanked API key for additional market data (or set JBLANKED_API_KEY env var)
# OPTIONAL - Leave empty if not using this provider
jblanked_api_key = ""

# Enable TradingView for traditional market data (SPX, etc.)
# REQUIRES API KEY - Not available for free
# Recommended: false unless you have TradingView API access
use_tradingview = false

# Cache TTL for external market data (in seconds)
# Recommended: 900 (15 minutes)
cache_ttl_seconds = 900

[signals.sentiment]
# Enable sentiment data collection (Fear & Greed Index, social sentiment)
# Recommended: true for production
enabled = true

# Enable Crypto Fear & Greed Index from Alternative.me
# FREE - No API key required
# Provides market sentiment score from 0 (extreme fear) to 100 (extreme greed)
# Recommended: true (free, no API key required)
use_fear_greed_index = true

# Enable social media sentiment (Twitter/X)
# REQUIRES API KEY - Not available for free
# Recommended: false unless you have API access
use_social_sentiment = false

# Cache TTL for sentiment data (in seconds)
# Recommended: 1800 (30 minutes)
cache_ttl_seconds = 1800

[signals.computed]
# Enable computed signals (technical indicators, volatility, correlations)
# Recommended: true for production
enabled = true

# Lookback period for technical indicators (in hours)
# Recommended: 168 (7 days)
technical_lookback_hours = 168

# Lookback period for volatility calculations (in hours)
# Recommended: 168 (7 days)
volatility_lookback_hours = 168

# Lookback period for correlation calculations (in days)
# Recommended: 30 days
correlation_lookback_days = 30

# Cache TTL for computed signals (in seconds)
# Recommended: 300 (5 minutes)
cache_ttl_seconds = 300

[signals.cache]
# Interval for automatic cache cleanup (in seconds)
# Removes expired entries to prevent database bloat
# Recommended: 3600 (1 hour)
cleanup_interval_seconds = 3600

# Run VACUUM on startup to optimize database
# Recommended: true
vacuum_on_startup = true

# Maximum cache size (in MB) before triggering cleanup
# Recommended: 100 MB for hobby trading, 500 MB for active trading
max_size_mb = 100
